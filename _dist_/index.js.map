{
  "version": 3,
  "sources": ["/home/runner/work/Three.LS/Three.LS/src/index.ts"],
  "sourcesContent": ["import * as THREE from 'three';\nimport { Clock, Euler, Scene } from 'three';\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls.js';\nimport { Turtle3D } from './Turtles/Turtle3D';\nimport { LindenmayerFormular } from './LindenmayerFormular';\nimport PerformanceStats from './PerformanceStats';\nimport { ARButton } from 'three/examples/jsm/webxr/ARButton.js';\n\nexport let scene: Scene;\nlet camera: THREE.PerspectiveCamera;\nlet renderer: THREE.WebGLRenderer;\nlet controls: TrackballControls;\nconst sceneClock: Clock = new Clock();\n\nlet branchingIds: Set<number> = new Set();\n\n// Can we handle routes differently somehow? ~bas\nconst windowLocationHref: string = window.location.href;\nconst windowFileLocationName: string = windowLocationHref.substring(windowLocationHref.lastIndexOf('/'));\n\nswitch (windowFileLocationName) {\n    case '/':\n        const lindenmayerSettingsForm: LindenmayerFormular = LindenmayerFormular.getInstance();\n        const newTurtle: Turtle3D = lindenmayerSettingsForm.generateLSystemImage();\n\n        if (scene !== undefined) {\n            repaint(newTurtle);\n        } else {\n            initTestingScene(newTurtle);\n            animate();\n        }\n        break;\n    case '/ar.html':\n        initArTestingScene();\n        animate();\n\n        break;\n    default:\n        console.error('Route not found');\n}\n\nfunction hookUpGenerateButtonEventListener() {\n    const btnGenerate: HTMLInputElement = document.querySelector('#btnGenerate');\n    btnGenerate.addEventListener('click', (e) => {\n        e.preventDefault();\n        generateAndRepaintLindenmayerMesh();\n    });\n}\n\nexport function generateAndRepaintLindenmayerMesh() {\n    const form: LindenmayerFormular = LindenmayerFormular.getInstance();\n    const newTurtle: Turtle3D = form.generateLSystemImage();\n    if (scene !== undefined) {\n        repaint(newTurtle);\n    } else {\n        initTestingScene(newTurtle);\n        animate();\n    }\n}\n\nfunction initTestingScene(turtle: Turtle3D) {\n    renderer = new THREE.WebGLRenderer();\n    renderer.setSize(window.innerWidth, window.innerHeight);\n    renderer.setPixelRatio(window.devicePixelRatio);\n    document.body.appendChild(renderer.domElement);\n\n    camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 10000);\n\n    controls = new TrackballControls(camera, renderer.domElement);\n    controls.rotateSpeed = 2;\n    camera.position.set(0, 0, 15);\n    controls.update();\n\n    scene = new THREE.Scene();\n\n    turtle.addGeometryToScene(scene);\n\n    branchingIds = turtle.branchingIds;\n\n    console.log(scene);\n\n    sceneClock.start();\n\n    renderer.render(scene, camera);\n\n    // const directionalLight: THREE.DirectionalLight = new THREE.DirectionalLight(0xffffff, 1);\n    // // directionalLight.target = mesh;\n    // directionalLight.position.set(0, -4, 10);\n    // scene.add(directionalLight);\n\n    const light = new THREE.AmbientLight(0xffffff, 1); // soft white light\n    scene.add(light);\n\n    window.addEventListener('resize', onWindowResize, false);\n\n    hookUpGenerateButtonEventListener();\n}\n\nfunction initArTestingScene() {\n    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);\n\n    scene = new THREE.Scene();\n\n    renderer = new THREE.WebGLRenderer();\n    renderer.setSize(window.innerWidth, window.innerHeight);\n    renderer.setPixelRatio(window.devicePixelRatio);\n    renderer.xr.enabled = true;\n    document.body.appendChild(renderer.domElement);\n\n    document.body.appendChild(ARButton.createButton(renderer));\n\n    const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);\n    light.position.set(0.5, 1, 0.25);\n    scene.add(light);\n\n    // TODO: replace this geometry with a generated tree somehow\n    const geometry = new THREE.CylinderGeometry(0, 0.05, 0.2, 32).rotateX(Math.PI / 2);\n\n    function onSelect() {\n        const material = new THREE.MeshPhongMaterial({ color: 0xffffff * Math.random() });\n        const mesh = new THREE.Mesh(geometry, material);\n        mesh.position.set(0, 0, -0.3).applyMatrix4(controller.matrixWorld);\n        mesh.quaternion.setFromRotationMatrix(controller.matrixWorld);\n        scene.add(mesh);\n    }\n\n    const controller = renderer.xr.getController(0);\n    controller.addEventListener('select', onSelect);\n    scene.add(controller);\n\n    renderer.render(scene, camera);\n\n    window.addEventListener('resize', onWindowResize, false);\n}\n\nfunction repaint(turtle: Turtle3D) {\n    for (let i = scene.children.length - 1; i >= 0; i--) {\n        const obj = scene.children[i];\n        scene.remove(obj);\n    }\n    turtle.addGeometryToScene(scene);\n    branchingIds = turtle.branchingIds;\n}\n\nfunction animate() {\n    renderer.setAnimationLoop(render);\n}\n\nfunction render() {\n    renderer.render(scene, camera);\n\n    controls?.update(); // Only update controls if present\n    PerformanceStats.instance?.update(); // Only update stats if present\n\n    branchingIds.forEach((eachId) => {\n        const obj: THREE.Object3D = scene.getObjectById(eachId);\n        if (obj) {\n            obj.rotation.copy(\n                new Euler(\n                    Math.sin(sceneClock.getElapsedTime() * 2) * 0.002 - 0.001,\n                    Math.sin(sceneClock.getElapsedTime() * 1) * 0.02 - 0.01,\n                    Math.cos(sceneClock.getElapsedTime() * 1.3) * 0.003 - 0.0015,\n                    'XYZ',\n                ),\n            );\n        }\n    });\n}\n\nfunction onWindowResize() {\n    camera.aspect = window.innerWidth / window.innerHeight;\n    camera.updateProjectionMatrix();\n\n    renderer.setSize(window.innerWidth, window.innerHeight);\n}\n"],
  "mappings": "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",
  "names": []
}
